<!doctype html><html lang=en><head><script>location.host!=new URL("https://cauliyang.github.io/").host&&(location.href="https://cauliyang.github.io/")</script><meta name=viewport content="width=device-width"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=7"><link rel=icon href=/favicon.png><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=icon href=/logo.svg type=image/svg+xml><title>Guide for building Cpp Development in Bioinformatics &ndash;
Yangyang Li's Geek Logs</title><link href=/symbols-nerd-font/symbols-nerd-font.css rel=stylesheet integrity="sha512-lydow8GLOLlYNOtHlksNCmGWWCBsbIEtikXpHzfWqx78HLlyQZHOzyLwPpKol4Th6aCwLUXOfODVYgwrd3nwKQ=="><link href=/jetbrains-mono/jetbrains-mono.css rel=stylesheet integrity="sha512-tJxlgL6v1Y7kFf+qB8SloaAMKnOAw6WouknxXtIjkBux9Y/9aX81EUWOJO8c/3l98DmjG8brr4to7zaez606Fg=="><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><link type=text/css rel=stylesheet href=https://cauliyang.github.io/css/styles.f13b26608bee58be5a71a28a962268940cf92222048d1ee76e364329803107c0986170f96b89f0c24d03be85521b7514af6163a713f29d2e7b450c8933e9edfb.css integrity="sha512-8TsmYIvuWL5acaKKliJolAz5IiIEjR7nbjZDKYAxB8CYYXD5a4nwwk0DvoVSG3UUr2FjpxPynS57RQyJM+nt+w=="><meta name=author content="Yangyang Li"><meta name=keywords content="Develop"><meta name=description content="vironment I am preparing to develop a tool using C++ in the Linux and macOS environments. Usually, I do not have root rights to download dependencies for C++ using apt-get install -y denpendencies directly in Ubuntu. However, I usually feel frustrated when the dependency chain is complicated. That means I need to download and compile every library I use. This may cost you one night or even one week."><meta property="og:site_name" content="Yangyang Li's Geek Logs"><meta property="og:title" content="Guide for building Cpp Development in Bioinformatics"><meta property="og:type" content="article"><meta property="article:author" content="Yangyang Li"><meta property="article:published_time" content="2022-06-15T23:17:30Z-0500"><meta property="article:tag" content="Develop"><meta property="og:url" content="https://cauliyang.github.io/posts/003-guide-build-cpp-development-env-with-htslib/"><meta property="og:image" content="https://cauliyang.github.io/icon512.png"><meta property="og:description" content="1. Config Compile Environment I am preparing to develop a tool using C++ in the Linux and macOS environments. Usually, I do not have root rights to download dep"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="cauliyang.github.io"><meta property="twitter:url" content="https://cauliyang.github.io/posts/003-guide-build-cpp-development-env-with-htslib/"><meta name=twitter:title content="Guide for building Cpp Development in Bioinformatics"><meta name=twitter:image content="https://cauliyang.github.io/icon512.png"><meta name=twitter:description content="1. Config Compile Environment I am preparing to develop a tool using C++ in the Linux and macOS environments. Usually, I do not have root rights to download dep"><link rel=manifest href=/manifest/index.json></head><body><div id=baseContainer><header><div class=titleAndSearchContainer><div id=titleContainer><a class=unstyledLink href=/><img src=/logo.svg alt=Logo></a><div class=rightOfLogo><div class=titleAndHamburger><h1><a class=unstyledLink href=/>Yangyang Li's Geek Logs</a></h1><label id=hamburger-menu for=main-nav-toggler>&#xf85b;</label></div><div id=wide_nav><nav><input type=checkbox id=main-nav-toggler><ul id=main-nav><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=https://cauliyang.github.io/pages/about/>About</a></li><li><a href=/resume.pdf>CV</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></div></div><div class=search><input id=searchbar type=text placeholder=Search>
<a class=nerdlink onclick=newSearch()>&#xf002;</a></div><script>function newSearch(){let e=searchbar.value.trim();if(!e)return;location.href=`/search?q=${e}`}searchbar.onkeyup=e=>{e.keyCode==13&&newSearch()}</script></div><div id=links><a rel=noreferrer target=_blank class=nerdlink href=/index.xml>&#xf09e;
<span>RSS</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://github.com/cauliyang>&#xf09b;
<span>GitHub</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://twitter.com/yangyangliz5>&#xf099;
<span>Twitter</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=mailto:yangyang.li@norwestern.edu>&#xf6ed;
<span>Email</span></a>
<a rel=noreferrer target=_blank class=nerdlink href="https://scholar.google.com/citations?user=ByWsRVMAAAAJ&hl=en">Google Scholar
<span>Google Scholar</span></a></div></header><div id=contentContainer><div id=content><main><article class="card single"><h1>Guide for building Cpp Development in Bioinformatics</h1><p class=date><span title=Date></span>
2022-06-15</p><div class=articleToc><nav id=TableOfContents><ul><li><ul><li><a href=#1-config-compile-environment>1. Config Compile Environment</a><ul><li><a href=#11-install-gcc-or-clang>1.1 Install GCC or Clang</a></li></ul></li><li><a href=#2-add-htslib-dependencies>2. Add htslib dependencies</a><ul><li><a href=#21-cmake-scripts>2.1 Cmake Scripts</a></li></ul></li><li><a href=#3-recommend-practices>3. Recommend Practices</a></li><li><a href=#4-summary>4. Summary</a></li></ul></li></ul></nav><hr></div><div><h2 id=1-config-compile-environment>1. Config Compile Environment</h2><p>I am preparing to develop a tool using <em>C++</em> in the Linux and macOS environments.
Usually, I do not have root rights to download dependencies for C++ using <code>apt-get install -y denpendencies</code> directly in <em>Ubuntu</em>.
However, I usually feel frustrated when the dependency chain is complicated.
That means I need to download and compile every library I use.
This may cost you one night or even one week.
<strong><a href=https://docs.conda.io/en/latest/>Conda</a></strong> is a package manager mainly used in <em>the data-science</em> domain.
So far, <strong>Conda</strong> provides some other language dependencies, for instance <em>C++</em>, <em>Rust</em> and <em>R</em> as well.
For concrete package support, you can go through the <a href=https://anaconda.org/>Conda cloud</a>.
The package name in <a href=https://anaconda.org/>Conda cloud</a> may change at any time.
You may need to search for &ldquo;real name&rdquo; in Conda Cloud before installation.
Hence, <strong>Conda</strong> can be regarded as a tool used to install dependencies for <em>C++</em>, especially in <strong>the bioinformatics domain</strong>.
However, I must say that nowadays, there are several solutions for managing <em>C++</em> dependencies like <a href=https://vcpkg.io/en/index.html>Vcpkg</a>, <a href=https://conan.io/>Conan</a>, <a href=https://github.com/cpm-cmake/CPM.cmake>CPM</a>, etc.
I use <a href=https://github.com/cpm-cmake/CPM.cmake>CPM</a> as an alternative choice.</p><h3 id=11-install-gcc-or-clang>1.1 Install GCC or Clang</h3><p>When it comes to the compilation environment, it is important to install a compiler, and <a href=https://gcc.gnu.org/>GCC</a> or <a href=https://clang.llvm.org/>Clang</a> may be your choices.
In general, Linux systems will ship with GCC, but the version may be low (4.
9).
That will not allow you to use the latest features of <em>C++</em>.
In the meantime, you do not have root access yet.
But you can use <a href=https://docs.conda.io/en/latest/>Conda</a> to install any version of GCC or Clang by running <code>conda install -c conda-forge gcc</code> or <code>conda install -c conda-forge clang</code>.
Keep in mind that you should search for GCC or clang in <a href=https://anaconda.org/>Conda cloud</a> first before installation in order to install the proper version.</p><p>After installation, Conda may set three significant variables for you: <code>CFLAGS</code>, <code>CXXFLAGS,</code> and <code>LDFLAGS</code>.
You can check that by using <code>echo $CFLAGS</code>.
You need to set that in your <code>~/.bashrc</code> or <code>~/.zshrc</code> if you do not find that. Here are examples:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CXXFLAGS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;-fvisibility-inlines-hidden -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /your_conda_absolute_path/miniconda3/include&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>CFLAGS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;-march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /your_conda_absolute_path/include&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>LDFLAGS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;-Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,--allow-shlib-undefined -Wl,-rpath,/your_conda_absolute_path/miniconda3/lib -Wl,-rpath-link,/your_conda_absolute_path/miniconda3/lib -L/your_conda_absolute_path/miniconda3/lib&#34;</span>
</span></span></code></pre></div><p><strong>You must change your Conda absolute path to your path of Conda</strong>.
I installed Conda in the base environment, and I also recommend installing GCC or clang in the base environment.</p><h2 id=2-add-htslib-dependencies>2. Add htslib dependencies</h2><p><strong><a href=https://github.com/samtools/htslib>Htslib</a></strong> is a classic and well-known library used to manage bioinformatics format files, including <em>bam</em>, <em>sam</em>, <em>vcf</em>, and <em>bcf,</em> etc.</p><p><strong>Htslib</strong> is implemented in <em>C</em> so that it is able to meet high performance requirements.
So far, many popular tools, for example <em><a href=http://www.htslib.org/>samtools</a></em> and <em><a href=http://samtools.github.io/bcftools/bcftools.html>bcftools</a>,</em> are all based on htslib.
There are wrappers for other languages like <em><a href=https://github.com/pysam-developers/pysam>pysam</a></em> based on <em>Python</em>, <em><a href=https://bioconductor.org/packages/release/bioc/html/Rhtslib.html>rhtslib</a></em> based on <em>R, and</em> <em>[rust_htslib]</em> based on <em>Rust</em>.
That will enable people using different languages to apply htslib in their applications.</p><p><em><a href=https://zlib.net/>Zlib</a></em> is only one library that htslib must depend on.
In the meantime, htslib has other dependencies, which enables htslib to have more rich features.
Here, I will not explain what feature dependencies will provide respectably.
The detailed information can be found on the <a href=https://github.com/samtools/htslib>Htslib</a> website.
<strong>However, *Conda* can install htslib easily by <code>conda install htslib</code></strong>.
Keep in mind that we can also define the library version with <code>conda install htslib=1.15.1</code>.
As mentioned above, htslib may have been installed in your environment if samtools or bcftools are already installed.</p><h3 id=21-cmake-scripts>2.1 Cmake Scripts</h3><p>I use <a href=https://cmake.org/>Cmake</a> as a build system, and here are several useful and valuable Cmake scripts.
You can use that in your project.
I think it will help you fix most dependency problems with htslib.</p><ul><li><p><a href=https://gist.github.com/cauliyang/c6d69c43a8a05266c6d05bc2c5324f45>htslib.cmake</a></p></li><li><p><a href=https://gist.github.com/cauliyang/01f360df26fa287a1e111dd00bb076e4>FindHTSlib.cmake</a></p></li><li><p><a href=https://gist.github.com/cauliyang/a39f3b10ed3d85d2ca13645d81dd829e>FindDeflate.cmake</a></p></li><li><p><a href=https://gist.github.com/cauliyang/0aa4487e58a0e5c830915ddbade5ce71>zlib.cmake</a></p></li></ul><p>Firstly, I assume your directory structure looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── CMakeLists.txt
</span></span><span style=display:flex><span>├── build
</span></span><span style=display:flex><span>├── cmake
</span></span><span style=display:flex><span>├── include
</span></span><span style=display:flex><span>└── <span style=color:#8be9fd;font-style:italic>source</span>
</span></span></code></pre></div><p>These cmake scripts should be found in the <code>cmake</code> directory. We can use in CmakeLists.txt</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>CMAKE_MODULE_PATH</span> <span style=color:#f1fa8c>&#34;${CMAKE_CURRENT_SOURCE_DIR}/cmake&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>include</span>(<span style=color:#f1fa8c>htslib</span>)
</span></span></code></pre></div><p>If <code>htslib</code> is found in your current environment, <code>cmake</code> will define the variables <code>HTSlib_FOUND</code> and HTSlib_INCLUDE_DIRS``and<code>HTSlib_LIBRARIES</code>.
Otherwise, <code>cmake</code>will build static htslib from sources, and<code>cmake</code>will check if every dependency of htslib exists respectively.
If it exists,<code>cmake</code>will use the compiler flags of htslib to build a static library.
Otherwise,<code>cmake</code>will disable related compiler flags.
However, <a href=https://zlib.net/>zlib</a> is the only one that must exist.
So, if <a href=https://zlib.net/>zlib</a> does not exist,<code>cmake</code> will help you build <a href=https://zlib.net/>zlib</a> from source.
All these CMake scripts can be found at the above link.
Please feel free to explore that.</p><p>Indeed, we use <a href=https://gist.github.com/cauliyang/01f360df26fa287a1e111dd00bb076e4>FindHTSlib.cmake</a> to search for htslib.
<a href=https://gist.github.com/cauliyang/c6d69c43a8a05266c6d05bc2c5324f45>htslib.cmake</a> is shown below, and I have added some comments to explain how it works.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>include</span>(<span style=color:#f1fa8c>ExternalProject</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># find htslib by using FindHTSlib.cmake
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>find_package</span>(<span style=color:#f1fa8c>HTSlib</span>)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>HTSlib_FOUND</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>message</span>(<span style=color:#f1fa8c>STATUS</span> <span style=color:#f1fa8c>&#34;HTSlib_USE_STATIC_LIBS: ${HTSlib_USE_STATIC_LIBS}&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4># not found, try to build it to static libs from source
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>else</span>()
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>set</span>(<span style=color:#f1fa8c>htslib_PREFIX</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>CMAKE_BINARY_DIR</span><span style=color:#ff79c6>}</span><span style=color:#f1fa8c>/cmake-ext/htslib-prefix</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>set</span>(<span style=color:#f1fa8c>htslib_INSTALL</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>CMAKE_BINARY_DIR</span><span style=color:#ff79c6>}</span><span style=color:#f1fa8c>/cmake-ext/htslib-install</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>CMAKE_GENERATOR</span> <span style=color:#f1fa8c>STREQUAL</span> <span style=color:#f1fa8c>&#34;Unix Makefiles&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>set</span>(<span style=color:#f1fa8c>MAKE_COMMAND</span> <span style=color:#f1fa8c>&#34;$(MAKE)&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>else</span>()
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>find_program</span>(<span style=color:#f1fa8c>MAKE_COMMAND</span> <span style=color:#f1fa8c>NAMES</span> <span style=color:#f1fa8c>make</span> <span style=color:#f1fa8c>gmake</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>message</span>(<span style=color:#f1fa8c>STATUS</span> <span style=color:#f1fa8c>&#34;Building static htslib from source&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>message</span>(<span style=color:#f1fa8c>NOTICE</span> <span style=color:#f1fa8c>&#34;Set ENV CFLAGS and CXXFLAGS if you use conda environment!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>set</span>(<span style=color:#f1fa8c>disable_flags</span> <span style=color:#f1fa8c>--disable-gcs</span> <span style=color:#f1fa8c>--disable-s3</span> <span style=color:#f1fa8c>--disable-plugins</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4># find lzma if not founed the disable compiler flags
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>find_package</span>(<span style=color:#f1fa8c>LibLZMA</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>LIBLZMA_FOUND</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>include_directories</span>(<span style=color:#f1fa8c>SYSTEM</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>LIBLZMA_INCLUDE_DIRS</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>deps_LIB</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>LIBLZMA_LIBRARIES</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>else</span>()
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>disable_flags</span> <span style=color:#f1fa8c>--disable-lzma</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># find curl if not founed the disable compiler flags
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>find_package</span>(<span style=color:#f1fa8c>CURL</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>CURL_FOUND</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>include_directories</span>(<span style=color:#f1fa8c>SYSTEM</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>CURL_INCLUDE_DIRS</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>deps_LIB</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>CURL_LIBRARIES</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>else</span>()
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>disable_flags</span> <span style=color:#f1fa8c>--disable-libcurl</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>#find bzip2 if not founed the disable compiler flags
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>find_package</span>(<span style=color:#f1fa8c>BZip2</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>BZIP2_FOUND</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>include_directories</span>(<span style=color:#f1fa8c>SYSTEM</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>BZIP2_INCLUDE_DIRS</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>deps_LIB</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>BZIP2_LIBRARIES</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>else</span>()
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>disable_flags</span> <span style=color:#f1fa8c>--disable-bz2</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4># find defalte if not founed the disable compiler flags
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>find_package</span>(<span style=color:#f1fa8c>Deflate</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>Deflate_FOUND</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>include_directories</span>(<span style=color:#f1fa8c>SYSTEM</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>Deflate_INCLUDE_DIRS</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>deps_LIB</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>Deflate_LIBRARIES</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>message</span>(<span style=color:#f1fa8c>STATUS</span> <span style=color:#f1fa8c>&#34; dependencies: ${deps_LIB}&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#6272a4># compiler and install htslib from source
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>ExternalProject_Add</span>(
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>htslib</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>PREFIX</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>htslib_PREFIX</span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>URL</span> <span style=color:#f1fa8c>https://github.com/samtools/htslib/releases/download/1.15.1/htslib-1.15.1.tar.bz2</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>BUILD_IN_SOURCE</span> <span style=color:#f1fa8c>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>UPDATE_COMMAND</span> <span style=color:#f1fa8c>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>CONFIGURE_COMMAND</span> <span style=color:#f1fa8c>autoreconf</span> <span style=color:#f1fa8c>-i</span> <span style=color:#f1fa8c>&amp;&amp;</span> <span style=color:#f1fa8c>./configure</span> <span style=color:#f1fa8c>--prefix=</span><span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>htslib_PREFIX</span><span style=color:#ff79c6>}</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>disable_flags</span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>BUILD_COMMAND</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>MAKE_COMMAND</span><span style=color:#ff79c6>}</span> <span style=color:#f1fa8c>lib-static</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>INSTALL_COMMAND</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>MAKE_COMMAND</span><span style=color:#ff79c6>}</span> <span style=color:#f1fa8c>install</span> <span style=color:#f1fa8c>prefix=</span><span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>htslib_INSTALL</span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># user pre-defined variable (-DZLIB_BUILD=ON) to control is build zlib from sources
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>message</span>(<span style=color:#f1fa8c>STATUS</span> <span style=color:#f1fa8c>&#34;ZLIB_BUILD: ${ZLIB_BUILD}&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>ZLIB_BUILD</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>include</span>(<span style=color:#f1fa8c>cmake/zlib.cmake</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>add_dependencies</span>(<span style=color:#f1fa8c>htslib</span> <span style=color:#f1fa8c>zlib</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>else</span>()
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>find_package</span>(<span style=color:#f1fa8c>ZLIB</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>ZLIB_FOUND</span>)
</span></span><span style=display:flex><span>      <span style=color:#8be9fd;font-style:italic>include_directories</span>(<span style=color:#f1fa8c>SYSTEM</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>ZLIB_INCLUDE_DIRS</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>      <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>deps_LIB</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>ZLIB_LIBRARIES</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>else</span>()
</span></span><span style=display:flex><span>      <span style=color:#6272a4># build zlib from source
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      <span style=color:#8be9fd;font-style:italic>message</span>(<span style=color:#f1fa8c>STATUS</span> <span style=color:#f1fa8c>&#34;Building zlib from source&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#8be9fd;font-style:italic>include</span>(<span style=color:#f1fa8c>cmake/zlib.cmake</span>)
</span></span><span style=display:flex><span>      <span style=color:#8be9fd;font-style:italic>add_dependencies</span>(<span style=color:#f1fa8c>htslib</span> <span style=color:#f1fa8c>zlib</span>)
</span></span><span style=display:flex><span>      <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>deps_LIB</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>zlib_LIBRARIES</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#f1fa8c>APPEND</span> <span style=color:#f1fa8c>deps_LIB</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>zlib_LIBRARIES</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># define two variables for usage
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>set</span>(<span style=color:#f1fa8c>HTSlib_INCLUDE_DIRS</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>htslib_INSTALL</span><span style=color:#ff79c6>}</span><span style=color:#f1fa8c>/include</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>set</span>(<span style=color:#f1fa8c>HTSlib_LIBRARIES</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>htslib_INSTALL</span><span style=color:#ff79c6>}</span><span style=color:#f1fa8c>/lib/libhts.a</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>deps_LIB</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>message</span>(<span style=color:#f1fa8c>STATUS</span> <span style=color:#f1fa8c>&#34;HTSlib_INCLUDE_DIRS: ${HTSlib_INCLUDE_DIRS}&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>message</span>(<span style=color:#f1fa8c>STATUS</span> <span style=color:#f1fa8c>&#34;HTSlib_LIBRARIES: ${HTSlib_LIBRARIES}&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span></code></pre></div><p>Now you can use the htslib like this in cmake:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>add_library</span>(<span style=color:#f1fa8c>test</span> <span style=color:#f1fa8c>test.h</span> <span style=color:#f1fa8c>test.cpp</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># if htslib is not in your environment
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>if</span>(<span style=color:#f1fa8c>NOT</span> <span style=color:#f1fa8c>HTSlib_FOUND</span>)
</span></span><span style=display:flex><span> <span style=color:#6272a4># if htslib build from source you need add this
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>add_dependencies</span>(<span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>PROJECT_NAME</span><span style=color:#ff79c6>}</span> <span style=color:#f1fa8c>htslib</span>)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>endif</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>target_link_libraries</span>(<span style=color:#f1fa8c>test</span> <span style=color:#f1fa8c>PRIVATE</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>HTSlib_LIBRARIES</span><span style=color:#ff79c6>}</span>)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>target_include_directories</span>(<span style=color:#f1fa8c>test</span> <span style=color:#f1fa8c>PRIVATE</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>HTSlib_INCLUDE_DIRS</span><span style=color:#ff79c6>}</span> <span style=color:#ff79c6>${</span><span style=color:#8be9fd;font-style:italic>HTSlib_INCLUDE_DIRS</span><span style=color:#ff79c6>}</span><span style=color:#f1fa8c>/htslib</span>)
</span></span></code></pre></div><p>You can change <code>PRIVATE</code> to <code>PUBLIC</code> if you want to export htslib. It depends on your goal.</p><h2 id=3-recommend-practices>3. Recommend Practices</h2><p>In the beginning, I recommend you use a suitable directory structure. Here are a few of the best examples:</p><ul><li><a href=https://github.com/TheLartians/ModernCppStarter>https://github.com/TheLartians/ModernCppStarter</a></li><li><a href=https://github.com/cpp-best-practices/gui_starter_template>https://github.com/cpp-best-practices/gui_starter_template</a></li><li><a href=https://github.com/filipdutescu/modern-cpp-template>https://github.com/filipdutescu/modern-cpp-template</a></li></ul><p>I prefer the first one. Using a good template can help you learn other tools in order to make the project better.
After you dive into one of the templates, I think you will learn more than you imagined.</p><h2 id=4-summary>4. Summary</h2><p>In this blog, I will introduce how to install <code>C++</code> dependencies and how to configure <code>htslib</code> in your development environment.
Various cmake scripts are provided and can help the project fix <code>htslib</code> dependency problems smoothly.
The source of these scripts at the top.
If you have any questions, please feel free to reach me.
Thanks for your time and reading!</p></div></article><hr><p class=articleTagsContainer><span></span>
<strong>Tags:</strong>
<a href=/tags/develop>#Develop</a></p><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><div id=ficurinia-cactus-comments></div><script>initComments({node:document.getElementById("ficurinia-cactus-comments"),defaultHomeserverUrl:"https://matrix.cactus.chat:8448",serverName:"cactus.chat",siteName:"blog",commentSectionId:"e12d2c8bd26a38a5d1165e941c0d8706"})</script><div class=relatedArticlesContainer><hr><h2>More posts like this</h2><div class=postlist><article class="card postlistitem"><div><h2><a href=https://cauliyang.github.io/posts/009-new-tool-bioinformatics-toolbox-aka-boss/>Bioinformatics Toolbox Aka Boss</a></h2><p class=date><span title=Date></span>
2022-09-25
|
<span title=Tags></span>
<a href=/tags/bioinformatics>#Bioinformatics</a>
<a href=/tags/c++>#C++</a>
<a href=/tags/develop>#Develop</a></p><div class=articlePreview><p>A toolbox for bioinformatics analysis in C++</p><p><a href=https://cauliyang.github.io/posts/009-new-tool-bioinformatics-toolbox-aka-boss/>Continue reading </a></p></div></div><hr></article><article class="card postlistitem"><div><h2><a href=https://cauliyang.github.io/posts/001-a-wonderful-library-you-must-not-know/>A Python Toolbox - Pybox</a></h2><p class=date><span title=Date></span>
2021-12-03
|
<span title=Tags></span>
<a href=/tags/develop>#Develop</a>
<a href=/tags/python>#Python</a></p><a class=unstyledLink href=https://cauliyang.github.io/posts/001-a-wonderful-library-you-must-not-know/><img src=https://cdn.jsdelivr.net/gh/cauliyang/blog-image@main//img/logo.png alt></a><div class=articlePreview><p>A toolbox including a batch of useful commands for annoying tasks.</p><p><a href=https://cauliyang.github.io/posts/001-a-wonderful-library-you-must-not-know/>Continue reading </a></p></div></div><hr></article></div></div></main><footer><hr><p><small>2022 &copy; Yangyang Li - <a href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</small></p><p><small><a href=https://gitlab.com/gabmus/hugo-ficurinia>Ficurinia theme</a> for <a href=https://gohugo.io>Hugo</a> by <a href=https://gabmus.org>Gabriele Musco</a>. Licensed under <a href=https://www.gnu.org/licenses/agpl-3.0.html>GNU AGPLv3</a>.</small></p></footer></div></div></div><script async defer data-domain=example.com src=https://something.com/...></script>
<script async defer data-website-id=example-tracking-code src=https://something.com/...></script></body></html>